<!-- templates/index.html - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ©Ÿèƒ½å¯¾å¿œç‰ˆ -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€ æƒ°ãªå¤§å­¦ç”Ÿæ˜¯æ­£ã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header>
            <div class="header-top">
                <div>
                    <h1 class="app-title">â˜ ï¸ æ€ æƒ°æ˜¯æ­£ã‚¢ãƒ—ãƒª</h1>
                    <p class="subtitle">è‡ªåˆ†ã®æ€ æƒ°ã‚’æ”¹ã‚ã‚ˆã†</p>
                </div>
                <div class="header-user">
                    <a href="{{ url_for('profile') }}" class="user-link" title="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«">
                        ğŸ‘¤ {{ user.display_name or user.username }}
                    </a>
                    <a href="{{ url_for('logout') }}" style="color: #aaa; text-decoration: none; margin-left: 10px; font-size: 0.9em; border: 1px solid #555; padding: 5px 10px; border-radius: 15px; background: #333;">
                        ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </a>
                </div>
            </div>
            
            <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('tasks')">ğŸ“‹ ã‚¿ã‚¹ã‚¯</button>
                <button class="tab-btn" onclick="switchTab('ranking')">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
                <button class="tab-btn" onclick="switchTab('group')">ğŸ‘¥ ã‚°ãƒ«ãƒ¼ãƒ—</button>
                <button class="tab-btn" onclick="switchTab('badges')">ğŸ–ï¸ ãƒãƒƒã‚¸</button>
            </div>

            <!-- çµ±è¨ˆãƒ‘ãƒãƒ« -->
            <div class="stats-panel">
                <div class="stat-item">
                    <span class="stat-label">ğŸ“Š æ€ æƒ°åº¦</span>
                    <span class="stat-value" id="lazynessScore">0.0%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">âœ… å®Œäº†</span>
                    <span class="stat-value" id="completedCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">âš¡ é€£ç¶š</span>
                    <span class="stat-value" id="streakCount">0æ—¥</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ğŸ’€ é…ã‚ŒãŸå›æ•°</span>
                    <span class="stat-value" id="punishedCount">0</span>
                </div>
            </div>

            <button id="openModalBtn" class="add-btn">âš ï¸ ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ</button>
        </header>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main>
            <!-- ã‚¿ã‚¹ã‚¯ã‚¿ãƒ– -->
            <div id="tasks-tab" class="tab-content active">
                <ul class="task-list" id="taskList">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </ul>
            </div>

            <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¿ãƒ– -->
            <div id="ranking-tab" class="tab-content">
                <div class="ranking-section">
                    <h2>ğŸ† å…¨ä½“ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
                    <table class="ranking-table" id="globalRanking">
                        <thead>
                            <tr>
                                <th>é †ä½</th>
                                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                                <th>æ€ æƒ°åº¦</th>
                                <th>å®Œäº†</th>
                                <th>é…ã‚ŒãŸå›æ•°</th>
                            </tr>
                        </thead>
                        <tbody id="rankingBody">
                            <!-- JavaScriptã§ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ãƒ– -->
            <div id="group-tab" class="tab-content">
                <div class="group-section">
                    <h2>ğŸ‘¥ ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</h2>
                    
                    <div class="group-actions">
                        <button onclick="showGroupCreateForm()" class="btn-primary">æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ</button>
                        <button onclick="showGroupJoinForm()" class="btn-primary">ã‚°ãƒ«ãƒ¼ãƒ—ã«å‚åŠ </button>
                    </div>

                    <!-- ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆãƒ•ã‚©ãƒ¼ãƒ  -->
                    <form id="groupCreateForm" method="post" action="/group/create" style="display:none; margin-top: 20px; padding: 20px; background: #333; border-radius: 8px;">
                        <h3>ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ</h3>
                        <input type="text" name="group_name" placeholder="ã‚°ãƒ«ãƒ¼ãƒ—å" required maxlength="100">
                        <button type="submit" class="btn-primary">ä½œæˆ</button>
                        <button type="button" onclick="this.parentElement.style.display='none'" class="btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </form>

                    <!-- ã‚°ãƒ«ãƒ¼ãƒ—å‚åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <form id="groupJoinForm" method="post" action="/group/join" style="display:none; margin-top: 20px; padding: 20px; background: #333; border-radius: 8px;">
                        <h3>ã‚°ãƒ«ãƒ¼ãƒ—ã«å‚åŠ </h3>
                        <input type="text" name="invite_code" placeholder="æ‹›å¾…ã‚³ãƒ¼ãƒ‰ (ä¾‹: ABC123)" required maxlength="10">
                        <button type="submit" class="btn-primary">å‚åŠ </button>
                        <button type="button" onclick="this.parentElement.style.display='none'" class="btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </form>

                    <!-- å‚åŠ ä¸­ã®ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ -->
                    <div id="myGroupsList" style="margin-top: 30px;">
                        <!-- JavaScriptã§ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- ãƒãƒƒã‚¸ã‚¿ãƒ– -->
            <div id="badges-tab" class="tab-content">
                <div class="badges-section">
                    <h2>ğŸ–ï¸ ç²å¾—ãƒãƒƒã‚¸</h2>
                    <div class="badges-grid" id="badgesGrid">
                        <!-- JavaScriptã§ç”Ÿæˆ -->
                    </div>
                    
                    <h3 style="margin-top: 30px;">ãƒãƒƒã‚¸ä¸€è¦§</h3>
                    <ul class="badge-list">
                        <li>ğŸ”¥ <strong>7æ—¥é€£ç¶šé”æˆè€…</strong> - 7æ—¥é€£ç¶šã§ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†</li>
                        <li>âœ¨ <strong>10å€‹å®Œäº†é”æˆè€…</strong> - 10å€‹ã®ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†</li>
                        <li>ğŸ‘‘ <strong>å®Œç’§ä¸»ç¾©è€…</strong> - 5å€‹ä»¥ä¸Šã®ã‚¿ã‚¹ã‚¯ã‚’å‡¦åˆ‘ã‚¼ãƒ­ã§å®Œäº†</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <!-- ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content input-mode">
            <span class="close-btn" onclick="closeModal('addTaskModal')">&times;</span>
            <h2>ğŸ’€ ã‚¿ã‚¹ã‚¯ã®ä½œæˆ</h2>
            <form action="{{ url_for('add_task') }}" method="post">
                <label>ã‚„ã‚‹ã“ã¨ï¼ˆTask contentï¼‰</label>
                <input type="text" name="task_title" placeholder="ä¾‹ï¼šæ˜æ—¥ã®1é™ã«å‡ºå¸­ã™ã‚‹" maxlength="200" required>

                <label>æœŸé™ï¼ˆTime Limitï¼‰</label>
                <input type="datetime-local" name="deadline" required>

                <label style="color: #e74c3c; font-weight: bold;">é…ã‚ŒãŸæ™‚ã®æŠ•ç¨¿å†…å®¹ï¼ˆè‡ªå‹•æŠ•ç¨¿ï¼‰</label>
                <textarea name="penalty_text" placeholder="ä¾‹ï¼šä»Šæ—¥ã‚‚ä¸€é™ã«èµ·ãã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚æ˜æ—¥å±±ç”°ã«ã”é£¯ã‚’å¥¢ã‚Šã¾ã™ã€‚" maxlength="500" required></textarea>

                <button type="submit" class="danger-btn">ã‚¿ã‚¹ã‚¯ã«è¿½åŠ </button>
            </form>
        </div>
    </div>

    <!-- å½ãƒ„ã‚¤ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="fakeTweetModal" class="modal tweet-modal">
        <div class="modal-content tweet-content">
            <span class="close-btn" onclick="closeTweetModal()">&times;</span>
            <h3 style="color: #1da1f2;">ğŸ”” Discordè‡ªå‹•æŠ•ç¨¿é€šçŸ¥</h3>
            <p>ä»¥ä¸‹ã®å†…å®¹ãŒã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸã€‚</p>
            
            <div class="fake-tweet-card">
                <div class="tweet-header">
                    <div class="tweet-icon"></div>
                    <div class="tweet-name">{{ user.display_name or 'ã‚ãªãŸ' }} <span style="color:gray">@lazy_student</span></div>
                </div>
                <div class="tweet-body" id="tweetTextDisplay"></div>
                <div class="tweet-footer">
                    <span>ğŸ’¬ 12</span> <span>ğŸ”„ 89</span> <span>â¤ï¸ 204</span>
                </div>
            </div>

            <p style="margin-top: 20px; color: red; font-weight: bold;">ã‚ãªãŸã¯ä»Šå›ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã§ãã¾ã›ã‚“ã§ã—ãŸ</p>
            <button onclick="closeTweetModal()" class="close-tweet-btn">æ¬¡ã¯çµ¶å¯¾ã«é…ã‚Œãªã„ã¨ã„ã†æ°—æŒã¡ã§é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- Flashãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div id="flashContainer" class="flash-container">
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}">
                        <span>{{ message }}</span>
                        <button class="flash-close" onclick="this.parentElement.remove()">&times;</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- JavaScriptãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>

    <style>
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .header-user {
            text-align: right;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-link {
            background-color: #2ecc71;
            color: black;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-block;
        }

        .user-link:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
        }

        @media (max-width: 600px) {
            .header-top {
                flex-direction: column;
                gap: 15px;
            }

            .header-user {
                width: 100%;
                justify-content: center;
            }

            .user-link {
                text-align: center;
            }
        }
    </style>
</body>
</html>